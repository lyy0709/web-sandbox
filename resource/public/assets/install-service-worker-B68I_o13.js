(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var i=(t=>(t.READY="ready",t.LOG="log",t.RUN_START="run_start",t.ENVIRONMENT_STATUS="environment_status",t.ENVIRONMENT_ERROR="environment_error",t.SET_BACKGROUND_COLOR="set_background_color",t.INSTRUMENT="instrument",t.OUTPUT="output",t.ERROR="error",t.RUN_COMPLETE="run_complete",t))(i||{}),R=(t=>(t.SW_RECONNECT="sw_reconnect",t))(R||{}),_=(t=>(t[t.INITIALIZING=0]="INITIALIZING",t[t.INSTALLING_PACKAGES=1]="INSTALLING_PACKAGES",t[t.RUNNING_CODE=2]="RUNNING_CODE",t))(_||{}),d=(t=>(t.RUN_CODE="run",t.STOP_CODE="stop",t.PREPARE_ENVIRONMENT="prepare_environment",t))(d||{}),O=(t=>(t.SW_RECONNECT_RESPONSE="sw_reconnect_response",t))(O||{}),I=(t=>(t.FLUSH="flush",t.SW_RECONNECT_RESPONSE="sw_reconnect_response",t.FETCH_RESPONSE="fetch_response",t.INIT="init",t.PING="ping",t.DISCONNECT="disconnect",t))(I||{}),p=(t=>(t.SW_RECONNECT="sw_reconnect",t.FETCH_REQUEST="fetch_request",t.PONG="pong",t))(p||{});const l=new URLSearchParams(window.location.search);l.get("isStorybook");const C="serviceWorker"in navigator&&l.get("enableServiceWorker")==="true",L=l.get("sessionId")??"",h=(t,...e)=>{},u=new Set,P=t=>(u.add(t),()=>u.delete(t));let E=new MessageChannel;const g=()=>"https://chatgpt.com",N=(t,e=[])=>{const n=new MessageChannel;window.parent.postMessage(t,g(),[n.port2,...e]),E=n,E.port1.onmessage=w},w=async t=>{const{data:e}=t;for(const n of u)n(e)},A=()=>{N({type:i.READY})},o=new Map,f={log:(t,...e)=>{h(t,...e)},error:(t,e)=>{console.error("[sandbox]",t,e),N({type:i.INSTRUMENT,instrument:{type:"error",message:t,error:e}})},count:(t,e)=>{N({type:i.INSTRUMENT,instrument:{type:"count",label:t,count:e}})},time:t=>{o.has(t),o.set(t,performance.now())},timeEnd:t=>{if(!o.has(t))return;const e=performance.now(),n=e-(o.get(t)??e);o.delete(t),N({type:i.INSTRUMENT,instrument:{type:"perf",label:t,time:n}})}},U=({routeName:t,onComplete:e,onError:n})=>{C?(navigator.serviceWorker.register("/service-worker.js",{type:"classic"}),navigator.serviceWorker.ready.then(()=>{f.log("service worker install in",t),e()}).catch(c=>{f.log("service worker failed to install",c),n==null||n(c)})):navigator.serviceWorker.getRegistration().then(c=>c==null?void 0:c.unregister()).finally(()=>e())};export{_ as E,i as M,L as S,P as a,d as b,p as c,I as d,R as e,O as f,U as i,A as n,N as p,f as s};
